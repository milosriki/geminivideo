{
  "report_metadata": {
    "generated_at": "2025-12-05",
    "agent": "AGENT 89: MASTER FIX PLAN CREATOR",
    "total_errors_analyzed": 142,
    "total_fixes_planned": 89,
    "estimated_total_time": "18-24 days",
    "investor_readiness_status": "NOT READY - CRITICAL BLOCKERS EXIST"
  },
  "executive_summary": {
    "deployment_blockers": 28,
    "demo_blockers": 35,
    "data_quality_issues": 15,
    "polish_items": 11,
    "current_risk_level": "CRITICAL",
    "priority_message": "System cannot start in production without Phase 1 fixes. Cannot demonstrate to investors without Phase 2 fixes. Results will be incorrect without Phase 3 fixes."
  },
  "phase_1_critical_startup_blockers": {
    "description": "These errors prevent the system from starting. Fix these FIRST.",
    "estimated_time": "3-4 days",
    "total_fixes": 28,
    "fixes": [
      {
        "phase": 1,
        "priority": 1,
        "id": "P1-001",
        "file": "/home/user/geminivideo/services/titan-core/prompts/engine.py",
        "line": 93,
        "issue": "Syntax error: Invalid emoji character 'ðŸ›‘' in string literal causing Python compilation failure",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 93\n\"STOP. The Council REJECTED your script.\"",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-001"
      },
      {
        "phase": 1,
        "priority": 2,
        "id": "P1-002",
        "file": "/home/user/geminivideo/services/titan-core/prompts/engine.py",
        "line": 86,
        "issue": "Function get_critic_system_message() has no return statement - incomplete function",
        "fix_type": "EDIT",
        "fix_code": "# Complete the function by adding the closing triple quotes and complete OUTPUT FORMAT section\ndef get_critic_system_message(niche: str = \"fitness\") -> str:\n    return f\"\"\"\nROLE: You are a ruthless Ad Performance Algorithm (modeled after DeepCTR).\n\n[...existing content...]\n\nOUTPUT FORMAT:\nScore: [0-100]\nReasoning: [Brief explanation]\nWeaknesses: [List of issues]\nRecommendations: [Specific improvements]\n\"\"\"",
        "estimated_time": "5 minutes",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-002"
      },
      {
        "phase": 1,
        "priority": 3,
        "id": "P1-003",
        "file": "/home/user/geminivideo/frontend/src/components/ABTestingDashboard.tsx",
        "line": 365,
        "issue": "Unclosed JSX div element - opening <div> but closed with </td>",
        "fix_type": "EDIT",
        "fix_code": "// Line 365-367, add closing </div> before </td>\n<div className=\"flex items-center gap-2\">\n  <span className=\"font-semibold\">{variant.name}</span>\n  {isWinner && <Trophy className=\"text-yellow-400\" size={16} />}\n</div>\n</td>",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-003"
      },
      {
        "phase": 1,
        "priority": 4,
        "id": "P1-004",
        "file": "/home/user/geminivideo/services/titan-core/orchestrator.py",
        "line": 5,
        "issue": "Import path 'from engines.ensemble import council' is incorrect",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 5\nfrom .engines.ensemble import council",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-004"
      },
      {
        "phase": 1,
        "priority": 5,
        "id": "P1-005",
        "file": "/home/user/geminivideo/services/titan-core/ai_council/orchestrator.py",
        "line": 15,
        "issue": "Import uses non-existent 'backend_core' path instead of 'titan_core'",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 15\nfrom ..engines.ensemble import council",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-005"
      },
      {
        "phase": 1,
        "priority": 6,
        "id": "P1-006",
        "file": "/home/user/geminivideo/frontend/src/App.tsx",
        "line": 7,
        "issue": "Import path for ErrorBoundary is incorrect",
        "fix_type": "EDIT",
        "fix_code": "// Replace line 7\nimport { ErrorBoundary } from '@/components/layout/ErrorBoundary';",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-007"
      },
      {
        "phase": 1,
        "priority": 7,
        "id": "P1-007",
        "file": "/home/user/geminivideo/services/gateway-api/Dockerfile",
        "line": 28,
        "issue": "wget not installed but used in HEALTHCHECK - container will be killed",
        "fix_type": "ADD",
        "fix_code": "# Add after WORKDIR line (around line 12)\nRUN apk add --no-cache wget",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 8,
        "id": "P1-008",
        "file": "/home/user/geminivideo/services/meta-publisher/Dockerfile",
        "line": 34,
        "issue": "wget not installed but used in HEALTHCHECK",
        "fix_type": "ADD",
        "fix_code": "# Add after WORKDIR\nRUN apk add --no-cache wget",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 9,
        "id": "P1-009",
        "file": "/home/user/geminivideo/services/google-ads/Dockerfile",
        "line": 30,
        "issue": "wget not installed but used in HEALTHCHECK",
        "fix_type": "ADD",
        "fix_code": "# Add after FROM\nRUN apk add --no-cache wget",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 10,
        "id": "P1-010",
        "file": "/home/user/geminivideo/services/ml-service/Dockerfile",
        "line": 26,
        "issue": "curl not installed in slim image - health check fails",
        "fix_type": "EDIT",
        "fix_code": "# Modify existing apt-get install line\nRUN apt-get update && apt-get install -y \\\n    libgomp1 \\\n    curl \\\n    && rm -rf /var/lib/apt/lists/*",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 11,
        "id": "P1-011",
        "file": "/home/user/geminivideo/services/video-agent/Dockerfile",
        "line": 26,
        "issue": "curl not installed - HEALTHCHECK fails",
        "fix_type": "EDIT",
        "fix_code": "# Add curl to existing apt-get install\nRUN apt-get update && apt-get install -y \\\n    ffmpeg \\\n    libsm6 \\\n    libxext6 \\\n    libxrender-dev \\\n    libass-dev \\\n    curl \\\n    && rm -rf /var/lib/apt/lists/*",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 12,
        "id": "P1-012",
        "file": "/home/user/geminivideo/services/gateway-api/Dockerfile",
        "line": 15,
        "issue": "COPY shared /shared - wrong source path (build will fail)",
        "fix_type": "EDIT",
        "fix_code": "# Change build context in docker-compose.yml OR fix COPY path\n# Option 1: In docker-compose.yml, set build context to repo root\n# Option 2: Change Dockerfile line 15 to:\nCOPY ../../shared /shared",
        "estimated_time": "5 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 13,
        "id": "P1-013",
        "file": "/home/user/geminivideo/services/titan-core/Dockerfile",
        "line": 70,
        "issue": "CMD changes working directory at runtime - container may exit if directory missing",
        "fix_type": "EDIT",
        "fix_code": "# Add before CMD:\nWORKDIR /app/api\n# Then simplify CMD:\nCMD [\"uvicorn\", \"main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"8080\"]",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 14,
        "id": "P1-014",
        "file": "/home/user/geminivideo/.env.example",
        "line": null,
        "issue": "Missing FIREBASE_SERVICE_ACCOUNT_PATH - Firebase Auth will fail",
        "fix_type": "ADD",
        "fix_code": "# Add to .env.example:\nFIREBASE_SERVICE_ACCOUNT_PATH=/path/to/firebase-service-account.json\nFIREBASE_PROJECT_ID=your-project-id\nFIREBASE_CLIENT_EMAIL=firebase-adminsdk@your-project.iam.gserviceaccount.com\nFIREBASE_PRIVATE_KEY=\"-----BEGIN PRIVATE KEY-----\\n...\\n-----END PRIVATE KEY-----\\n\"",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 15,
        "id": "P1-015",
        "file": "/home/user/geminivideo/.env.example",
        "line": null,
        "issue": "Missing VITE_WS_URL - real-time features will fail",
        "fix_type": "ADD",
        "fix_code": "# Add to .env.example:\nVITE_WS_URL=ws://localhost:8080\n# Production: VITE_WS_URL=wss://api.your-domain.com",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 16,
        "id": "P1-016",
        "file": "/home/user/geminivideo/.env.example",
        "line": null,
        "issue": "Missing ENVIRONMENT variable - services check this for conditional logic",
        "fix_type": "ADD",
        "fix_code": "# Add to .env.example:\nENVIRONMENT=development\n# Production: ENVIRONMENT=production",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 17,
        "id": "P1-017",
        "file": "/home/user/geminivideo/docker-compose.yml",
        "line": 99,
        "issue": "DATABASE_URL not set for gateway-api - Prisma can't connect",
        "fix_type": "ADD",
        "fix_code": "# Add to gateway-api service environment:\nDATABASE_URL: postgresql://geminivideo:geminivideo@postgres:5432/geminivideo",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 18,
        "id": "P1-018",
        "file": "/home/user/geminivideo/services/gateway-api/package.json",
        "line": 17,
        "issue": "postinstall runs prisma generate but prisma folder might not exist",
        "fix_type": "EDIT",
        "fix_code": "# In Dockerfile, ensure prisma is copied BEFORE npm install:\nCOPY package*.json ./\nCOPY tsconfig.json ./\nCOPY prisma ./prisma\nRUN npm install",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 19,
        "id": "P1-019",
        "file": "/home/user/geminivideo/services/ml-service/src/thompson_sampler.py",
        "line": 219,
        "issue": "Division by zero - CTR calculation without guard clause",
        "fix_type": "EDIT",
        "fix_code": "# Replace lines 219-221\nif variant['impressions'] > 0:\n    variant['ctr'] = variant['clicks'] / variant['impressions']\nelse:\n    variant['ctr'] = 0.0\nif variant['clicks'] > 0:\n    variant['cvr'] = variant['conversions'] / variant['clicks']\nelse:\n    variant['cvr'] = 0.0",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#2"
      },
      {
        "phase": 1,
        "priority": 20,
        "id": "P1-020",
        "file": "/home/user/geminivideo/services/ml-service/src/ctr_model.py",
        "line": 183,
        "issue": "Array access without bounds check - will crash if predict() returns empty",
        "fix_type": "EDIT",
        "fix_code": "# Replace lines 183-184\npredictions = self.predict(features)\nif len(predictions) == 0:\n    raise ValueError('Model returned no predictions')\nreturn float(predictions[0])",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#10"
      },
      {
        "phase": 1,
        "priority": 21,
        "id": "P1-021",
        "file": "/home/user/geminivideo/services/ml-service/creative_attribution.py",
        "line": 411,
        "issue": "CTR calculation division by zero (minor - has guard but unclear)",
        "fix_type": "EDIT",
        "fix_code": "# Improve clarity with parentheses\nctr = ((total_clicks / total_impressions) * 100) if total_impressions > 0 else 0.0",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#8"
      },
      {
        "phase": 1,
        "priority": 22,
        "id": "P1-022",
        "file": "/home/user/geminivideo/services/ml-service/campaign_tracker.py",
        "line": 645,
        "issue": "Division by zero in ROAS accuracy calculation",
        "fix_type": "EDIT",
        "fix_code": "# Replace lines 645-647\nmax_roas = max(predicted_roas, actual_roas)\nif max_roas > 0:\n    roas_accuracy = max(0, 100 - (roas_error / max_roas * 100))\nelse:\n    roas_accuracy = 0",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#5"
      },
      {
        "phase": 1,
        "priority": 23,
        "id": "P1-023",
        "file": "/home/user/geminivideo/services/ml-service/src/auto_scaler.py",
        "line": 566,
        "issue": "Budget change percentage - division by zero and misleading when budget is 0",
        "fix_type": "EDIT",
        "fix_code": "# Replace budget_change_pct calculation\nif metrics.daily_budget > 0:\n    budget_change_pct = ((new_budget - metrics.daily_budget) / metrics.daily_budget * 100)\nelse:\n    budget_change_pct = 100.0 if new_budget > 0 else 0.0  # 100% increase from 0",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#12"
      },
      {
        "phase": 1,
        "priority": 24,
        "id": "P1-024",
        "file": "/home/user/geminivideo/frontend/src/hooks/useKeyboardShortcuts.ts",
        "line": 140,
        "issue": "TypeScript compilation errors - unclosed tags and unterminated regex",
        "fix_type": "EDIT",
        "fix_code": "# Review lines 140-153 and fix TypeScript syntax errors\n# Ensure all JSX tags are properly closed\n# Ensure all regex literals are complete",
        "estimated_time": "10 minutes",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-008"
      },
      {
        "phase": 1,
        "priority": 25,
        "id": "P1-025",
        "file": "/home/user/geminivideo/services/gateway-api/Dockerfile",
        "line": 8,
        "issue": "Prisma folder copy order - verify it's before npm install",
        "fix_type": "VERIFY",
        "fix_code": "# Verify Dockerfile has correct order:\n# COPY package*.json ./\n# COPY tsconfig.json ./\n# COPY prisma ./prisma\n# RUN npm install",
        "estimated_time": "2 minutes",
        "dependencies": ["P1-018"],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 26,
        "id": "P1-026",
        "file": "/home/user/geminivideo/database_schema.sql",
        "line": null,
        "issue": "Prisma schema vs SQL migrations mismatch - choose one approach",
        "fix_type": "DECISION",
        "fix_code": "# DECISION REQUIRED:\n# Option 1: Use only Prisma\n#   - Delete database_migrations/ folder\n#   - Run: cd services/gateway-api && npx prisma migrate dev\n# Option 2: Use only SQL\n#   - Remove Prisma from gateway-api\n#   - Use pg driver directly\n# RECOMMENDED: Option 1 (Prisma) for type safety",
        "estimated_time": "30 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 27,
        "id": "P1-027",
        "file": "/home/user/geminivideo/services/tiktok-ads/Dockerfile",
        "line": 2,
        "issue": "Node version mismatch - uses node:18 while others use node:20",
        "fix_type": "EDIT",
        "fix_code": "# Update line 2\nFROM node:20-alpine",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 1,
        "priority": 28,
        "id": "P1-028",
        "file": "/home/user/geminivideo/frontend/vite.config.ts",
        "line": 11,
        "issue": "Vite proxy uses VITE_API_URL but should use VITE_API_BASE_URL",
        "fix_type": "EDIT",
        "fix_code": "# Update vite.config.ts proxy target\ntarget: process.env.VITE_API_BASE_URL || 'http://localhost:8080'",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      }
    ]
  },
  "phase_2_high_demo_blockers": {
    "description": "These errors prevent a successful investor demo. Fix after Phase 1.",
    "estimated_time": "5-7 days",
    "total_fixes": 35,
    "fixes": [
      {
        "phase": 2,
        "priority": 29,
        "id": "P2-001",
        "file": "/home/user/geminivideo/services/gateway-api/src/routes/campaigns.ts",
        "line": 603,
        "issue": "Missing POST /api/campaigns/:id/resume endpoint",
        "fix_type": "ADD",
        "fix_code": "// Add after pause endpoint (line 603)\nrouter.post('/:id/resume', async (req, res) => {\n  const { id } = req.params;\n  try {\n    const result = await pgPool.query(\n      'UPDATE campaigns SET status = $1, updated_at = NOW() WHERE id = $2 RETURNING *',\n      ['active', id]\n    );\n    if (result.rows.length === 0) {\n      return res.status(404).json({ error: 'Campaign not found' });\n    }\n    res.json({ success: true, campaign: result.rows[0] });\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n});",
        "estimated_time": "15 minutes",
        "dependencies": ["P1-017"],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-001"
      },
      {
        "phase": 2,
        "priority": 30,
        "id": "P2-002",
        "file": "/home/user/geminivideo/services/gateway-api/src/routes/analytics.ts",
        "line": 577,
        "issue": "Missing GET /api/analytics/roi/performance endpoint",
        "fix_type": "ADD",
        "fix_code": "// Add new ROI endpoints\nrouter.get('/roi/performance', async (req, res) => {\n  const { timeRange } = req.query;\n  try {\n    // Query performance_metrics and calculate ROI\n    const result = await pgPool.query(`\n      SELECT \n        SUM(revenue) as total_revenue,\n        SUM(spend) as total_spend,\n        (SUM(revenue) / NULLIF(SUM(spend), 0)) as roi,\n        AVG(roas) as avg_roas\n      FROM performance_metrics\n      WHERE created_at >= NOW() - INTERVAL '1 ${timeRange}'\n    `);\n    res.json(result.rows[0]);\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n});",
        "estimated_time": "20 minutes",
        "dependencies": ["P1-017"],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-002"
      },
      {
        "phase": 2,
        "priority": 31,
        "id": "P2-003",
        "file": "/home/user/geminivideo/services/gateway-api/src/routes/analytics.ts",
        "line": 577,
        "issue": "Missing GET /api/analytics/roi/trends endpoint",
        "fix_type": "ADD",
        "fix_code": "// Add ROI trends endpoint\nrouter.get('/roi/trends', async (req, res) => {\n  const { period } = req.query;\n  try {\n    const result = await pgPool.query(`\n      SELECT \n        DATE_TRUNC($1, created_at) as period,\n        AVG(roas) as avg_roas,\n        SUM(revenue) as revenue,\n        SUM(spend) as spend\n      FROM performance_metrics\n      GROUP BY DATE_TRUNC($1, created_at)\n      ORDER BY period DESC\n      LIMIT 30\n    `, [period]);\n    res.json(result.rows);\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n});",
        "estimated_time": "20 minutes",
        "dependencies": ["P1-017"],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-002"
      },
      {
        "phase": 2,
        "priority": 32,
        "id": "P2-004",
        "file": "/home/user/geminivideo/services/gateway-api/src/routes/ab-tests.ts",
        "line": 485,
        "issue": "Missing POST /api/ab-tests/:id/start endpoint",
        "fix_type": "ADD",
        "fix_code": "// Add start endpoint\nrouter.post('/:id/start', async (req, res) => {\n  const { id } = req.params;\n  try {\n    const result = await pgPool.query(\n      'UPDATE experiments SET status = $1, started_at = NOW(), updated_at = NOW() WHERE id = $2 RETURNING *',\n      ['active', id]\n    );\n    if (result.rows.length === 0) {\n      return res.status(404).json({ error: 'AB test not found' });\n    }\n    res.json({ success: true, test: result.rows[0] });\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n});",
        "estimated_time": "15 minutes",
        "dependencies": ["P1-017"],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-003"
      },
      {
        "phase": 2,
        "priority": 33,
        "id": "P2-005",
        "file": "/home/user/geminivideo/services/gateway-api/src/routes/ab-tests.ts",
        "line": 485,
        "issue": "Missing POST /api/ab-tests/:id/stop endpoint",
        "fix_type": "ADD",
        "fix_code": "// Add stop endpoint\nrouter.post('/:id/stop', async (req, res) => {\n  const { id } = req.params;\n  try {\n    const result = await pgPool.query(\n      'UPDATE experiments SET status = $1, completed_at = NOW(), updated_at = NOW() WHERE id = $2 RETURNING *',\n      ['completed', id]\n    );\n    if (result.rows.length === 0) {\n      return res.status(404).json({ error: 'AB test not found' });\n    }\n    res.json({ success: true, test: result.rows[0] });\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n});",
        "estimated_time": "15 minutes",
        "dependencies": ["P1-017"],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-003"
      },
      {
        "phase": 2,
        "priority": 34,
        "id": "P2-006",
        "file": "/home/user/geminivideo/frontend/src/lib/api.ts",
        "line": 531,
        "issue": "promoteWinner sends wrong schema - needs variant_id and new_budget",
        "fix_type": "EDIT",
        "fix_code": "// Update promoteWinner function\nexport async function promoteWinner(testId: string, winner: 'A' | 'B', newBudget: number) {\n  // Get variant_id from the test\n  const test = await getABTest(testId);\n  const variantId = winner === 'A' ? test.variant_a_id : test.variant_b_id;\n  \n  return apiClient.post(`/api/ab-tests/${testId}/promote`, {\n    variant_id: variantId,\n    new_budget: newBudget\n  });\n}",
        "estimated_time": "10 minutes",
        "dependencies": [],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-004"
      },
      {
        "phase": 2,
        "priority": 35,
        "id": "P2-007",
        "file": "/home/user/geminivideo/services/gateway-api/src/index.ts",
        "line": 502,
        "issue": "Missing POST /api/publish/google endpoint",
        "fix_type": "ADD",
        "fix_code": "// Add Google Ads publish endpoint (proxy to google-ads service)\napp.post('/api/publish/google', async (req, res) => {\n  try {\n    const response = await axios.post(\n      `${GOOGLE_ADS_URL}/api/publish`,\n      req.body,\n      { headers: { 'Content-Type': 'application/json' } }\n    );\n    res.json(response.data);\n  } catch (error) {\n    console.error('Google publish error:', error);\n    res.status(error.response?.status || 500).json({\n      error: error.response?.data || error.message\n    });\n  }\n});",
        "estimated_time": "10 minutes",
        "dependencies": [],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-005"
      },
      {
        "phase": 2,
        "priority": 36,
        "id": "P2-008",
        "file": "/home/user/geminivideo/services/gateway-api/src/index.ts",
        "line": 502,
        "issue": "Missing POST /api/publish/tiktok endpoint",
        "fix_type": "ADD",
        "fix_code": "// Add TikTok Ads publish endpoint\napp.post('/api/publish/tiktok', async (req, res) => {\n  try {\n    // Use multi-platform publisher with platform filter\n    const response = await axios.post(\n      `${GATEWAY_API_URL}/api/publish/multi`,\n      { ...req.body, platforms: ['tiktok'] }\n    );\n    res.json(response.data);\n  } catch (error) {\n    res.status(error.response?.status || 500).json({\n      error: error.response?.data || error.message\n    });\n  }\n});",
        "estimated_time": "10 minutes",
        "dependencies": [],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-005"
      },
      {
        "phase": 2,
        "priority": 37,
        "id": "P2-009",
        "file": "/home/user/geminivideo/services/gateway-api/src/index.ts",
        "line": 2107,
        "issue": "Missing GET /api/publish/campaigns/:campaignId endpoint",
        "fix_type": "ADD",
        "fix_code": "// Add campaign publish jobs endpoint\napp.get('/api/publish/campaigns/:campaignId', async (req, res) => {\n  const { campaignId } = req.params;\n  try {\n    const result = await pgPool.query(\n      'SELECT * FROM publishing_jobs WHERE campaign_id = $1 ORDER BY created_at DESC',\n      [campaignId]\n    );\n    res.json({ jobs: result.rows });\n  } catch (error) {\n    res.status(500).json({ error: error.message });\n  }\n});",
        "estimated_time": "15 minutes",
        "dependencies": ["P1-017"],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-006"
      },
      {
        "phase": 2,
        "priority": 38,
        "id": "P2-010",
        "file": "/home/user/geminivideo/frontend/src/lib/api.ts",
        "line": 458,
        "issue": "Prediction accuracy endpoint path mismatch",
        "fix_type": "EDIT",
        "fix_code": "// Update getPredictionAccuracy to use correct path\nexport async function getPredictionAccuracy(timeRange: string) {\n  return apiClient.get('/api/predictions/accuracy', {\n    params: { timeRange }\n  });\n}",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "API_CONTRACT_MISMATCHES.json#MISMATCH-007"
      },
      {
        "phase": 2,
        "priority": 39,
        "id": "P2-011",
        "file": "/home/user/geminivideo/services/ml-service/src/cross_learner.py",
        "line": 333,
        "issue": "Uses non-existent Claude model ID",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 333\nmodel=\"claude-3-5-sonnet-20241022\",",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-006"
      },
      {
        "phase": 2,
        "priority": 40,
        "id": "P2-012",
        "file": "/home/user/geminivideo/scripts/validate-env.py",
        "line": 321,
        "issue": "Using deprecated gemini-pro model",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 321\nmodel = genai.GenerativeModel('gemini-2.0-flash-thinking-exp-1219')",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#3"
      },
      {
        "phase": 2,
        "priority": 41,
        "id": "P2-013",
        "file": "/home/user/geminivideo/frontend/api/generate.py",
        "line": 27,
        "issue": "Using old gemini-1.5-pro model",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 27\nmodel = genai.GenerativeModel('gemini-2.0-flash-thinking-exp-1219')",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#3"
      },
      {
        "phase": 2,
        "priority": 42,
        "id": "P2-014",
        "file": "/home/user/geminivideo/services/gateway-api/src/routes/streaming.ts",
        "line": 392,
        "issue": "Using deprecated gemini-pro in streaming",
        "fix_type": "EDIT",
        "fix_code": "// Replace line 392\nconst geminiModel = genAI.getGenerativeModel({ model: 'gemini-2.0-flash-thinking-exp' })",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#3"
      },
      {
        "phase": 2,
        "priority": 43,
        "id": "P2-015",
        "file": "/home/user/geminivideo/services/titan-core/engines/vertex_ai.py",
        "line": 60,
        "issue": "Fallback using old gemini-1.5-pro-002",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 60\nGEMINI_2_0_FLASH = 'gemini-2.0-flash-exp'  # Fallback",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#3"
      },
      {
        "phase": 2,
        "priority": 44,
        "id": "P2-016",
        "file": "/home/user/geminivideo/services/titan-core/ai_council/config.py",
        "line": 18,
        "issue": "Default Gemini model should be 2.0",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 18\nGEMINI_PRO_MODEL_ID = os.getenv('GEMINI_PRO_MODEL_ID', 'gemini-2.0-flash-exp')",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#3"
      },
      {
        "phase": 2,
        "priority": 45,
        "id": "P2-017",
        "file": "/home/user/geminivideo/.env.example",
        "line": null,
        "issue": "Missing VITE_META_PIXEL_ID for tracking",
        "fix_type": "ADD",
        "fix_code": "# Add to .env.example:\nVITE_META_PIXEL_ID=1234567890123456",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 2,
        "priority": 46,
        "id": "P2-018",
        "file": "/home/user/geminivideo/.env.example",
        "line": null,
        "issue": "Missing GCS_BUCKET for file uploads",
        "fix_type": "ADD",
        "fix_code": "# Add to .env.example:\nGCS_BUCKET=your-gcs-bucket-name\nGCP_PROJECT_ID=your-gcp-project-id",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 2,
        "priority": 47,
        "id": "P2-019",
        "file": "/home/user/geminivideo/.env.example",
        "line": null,
        "issue": "Missing PROJECT_ID environment variable",
        "fix_type": "ADD",
        "fix_code": "# Add to .env.example:\nPROJECT_ID=your-gcp-project-id",
        "estimated_time": "1 minute",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 2,
        "priority": 48,
        "id": "P2-020",
        "file": "/home/user/geminivideo/services/ml-service/requirements.txt",
        "line": 44,
        "issue": "PyTorch 2.1.0 is very outdated - missing major performance improvements",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 44\ntorch>=2.4.0",
        "estimated_time": "5 minutes + testing",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#1"
      },
      {
        "phase": 2,
        "priority": 49,
        "id": "P2-021",
        "file": "/home/user/geminivideo/services/ml-service/requirements.txt",
        "line": 43,
        "issue": "Transformers 4.36.0 is very outdated",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 43\ntransformers>=4.46.0",
        "estimated_time": "5 minutes + testing",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#1"
      },
      {
        "phase": 2,
        "priority": 50,
        "id": "P2-022",
        "file": "/home/user/geminivideo/frontend/api/requirements.txt",
        "line": 3,
        "issue": "Anthropic SDK 0.18.0 is old - missing prompt caching",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 3\nanthropic>=0.40.0",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#1"
      },
      {
        "phase": 2,
        "priority": 51,
        "id": "P2-023",
        "file": "/home/user/geminivideo/scripts/requirements-validation.txt",
        "line": 16,
        "issue": "Very old Anthropic SDK 0.7.0",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 16\nanthropic>=0.40.0",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#1"
      },
      {
        "phase": 2,
        "priority": 52,
        "id": "P2-024",
        "file": "/home/user/geminivideo/services/ml-service/requirements.txt",
        "line": 11,
        "issue": "scikit-learn 1.3.2 is from 2023",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 11\nscikit-learn>=1.5.0",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#1"
      },
      {
        "phase": 2,
        "priority": 53,
        "id": "P2-025",
        "file": "/home/user/geminivideo/services/ml-service/requirements.txt",
        "line": 46,
        "issue": "sentence-transformers 2.2.2 is outdated",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 46\nsentence-transformers>=3.3.0",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#1"
      },
      {
        "phase": 2,
        "priority": 54,
        "id": "P2-026",
        "file": "/home/user/geminivideo/frontend/package.json",
        "line": 15,
        "issue": "Old Google AI SDK @google/genai 0.2.0",
        "fix_type": "EDIT",
        "fix_code": "// Update package.json line 15\n\"@google/genai\": \"^0.5.0\"",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#2"
      },
      {
        "phase": 2,
        "priority": 55,
        "id": "P2-027",
        "file": "/home/user/geminivideo/services/gateway-api/package.json",
        "line": 21,
        "issue": "Old @google/generative-ai 0.21.0",
        "fix_type": "EDIT",
        "fix_code": "// Update package.json line 21\n\"@google/generative-ai\": \"^0.5.0\"",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#2"
      },
      {
        "phase": 2,
        "priority": 56,
        "id": "P2-028",
        "file": "/home/user/geminivideo/services/titan-core/api/start_api.sh",
        "lines": "5-7",
        "issue": "Hardcoded API key placeholders",
        "fix_type": "EDIT",
        "fix_code": "# Remove default placeholders and require env vars\nif [ -z \"$GEMINI_API_KEY\" ]; then\n  echo \"Error: GEMINI_API_KEY not set\"\n  exit 1\nfi\nif [ -z \"$OPENAI_API_KEY\" ]; then\n  echo \"Error: OPENAI_API_KEY not set\"\n  exit 1\nfi\nif [ -z \"$ANTHROPIC_API_KEY\" ]; then\n  echo \"Error: ANTHROPIC_API_KEY not set\"\n  exit 1\nfi",
        "estimated_time": "5 minutes",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-009"
      },
      {
        "phase": 2,
        "priority": 57,
        "id": "P2-029",
        "file": "/home/user/geminivideo/services/gateway-api/src/routes/campaigns.ts",
        "line": null,
        "issue": "Campaign response schema mismatch - missing fields",
        "fix_type": "EDIT",
        "fix_code": "// Update campaign query to return complete schema:\nconst result = await pgPool.query(`\n  SELECT \n    c.id, c.name, c.status, c.objective,\n    c.budget_daily as budget,\n    c.target_audience as targeting,\n    c.schedule,\n    c.created_at as \"createdAt\",\n    c.updated_at as \"updatedAt\",\n    json_agg(cr.*) as creatives\n  FROM campaigns c\n  LEFT JOIN creatives cr ON cr.campaign_id = c.id\n  WHERE c.id = $1\n  GROUP BY c.id\n`, [id]);\n\n// Transform snake_case to camelCase in response",
        "estimated_time": "30 minutes",
        "dependencies": ["P1-017"],
        "source_report": "API_CONTRACT_MISMATCHES.json#SCHEMA-001"
      },
      {
        "phase": 2,
        "priority": 58,
        "id": "P2-030",
        "file": "/home/user/geminivideo/services/gateway-api/src/lib/transform.ts",
        "line": null,
        "issue": "Add snake_case to camelCase transformation utility",
        "fix_type": "ADD",
        "fix_code": "// Create new file: src/lib/transform.ts\nexport function snakeToCamel(obj: any): any {\n  if (Array.isArray(obj)) {\n    return obj.map(snakeToCamel);\n  }\n  if (obj !== null && typeof obj === 'object') {\n    return Object.keys(obj).reduce((acc, key) => {\n      const camelKey = key.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase());\n      acc[camelKey] = snakeToCamel(obj[key]);\n      return acc;\n    }, {} as any);\n  }\n  return obj;\n}\n\n// Use in responses: res.json(snakeToCamel(result.rows))",
        "estimated_time": "20 minutes",
        "dependencies": [],
        "source_report": "API_CONTRACT_MISMATCHES.json#SCHEMA-002"
      },
      {
        "phase": 2,
        "priority": 59,
        "id": "P2-031",
        "file": "/home/user/geminivideo/docker-compose.yml",
        "line": 139,
        "issue": "GOOGLE_ADS_URL points to wrong port or service doesn't exist",
        "fix_type": "DECISION",
        "fix_code": "# DECISION REQUIRED:\n# Option 1: Remove GOOGLE_ADS_URL if service doesn't exist\n# Option 2: Add google-ads service to docker-compose.yml\n# Option 3: Update port to match actual service\n# RECOMMENDED: Option 1 (remove) if not using dedicated Google Ads service",
        "estimated_time": "10 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 2,
        "priority": 60,
        "id": "P2-032",
        "file": "/home/user/geminivideo/frontend/Dockerfile",
        "line": 16,
        "issue": "VITE_API_BASE_URL build arg not passed at build time",
        "fix_type": "EDIT",
        "fix_code": "# In docker-compose.yml frontend service, add:\nservices:\n  frontend:\n    build:\n      context: ./frontend\n      args:\n        VITE_API_BASE_URL: http://localhost:8080",
        "estimated_time": "5 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 2,
        "priority": 61,
        "id": "P2-033",
        "file": "/home/user/geminivideo/docker-compose.yml",
        "line": 260,
        "issue": "Gateway-api starts before ML service is ready",
        "fix_type": "EDIT",
        "fix_code": "# Increase gateway-api healthcheck start_period:\nservices:\n  gateway-api:\n    healthcheck:\n      start_period: 120s  # Wait for ML service (90s) + buffer",
        "estimated_time": "2 minutes",
        "dependencies": [],
        "source_report": "CONFIGURATION_ERRORS_REPORT.json"
      },
      {
        "phase": 2,
        "priority": 62,
        "id": "P2-034",
        "file": "/home/user/geminivideo/services/drive-intel/services/visual_cnn.py",
        "line": 626,
        "issue": "CRITICAL: Using Haar Cascade from 2001 - 70% accuracy vs 98% modern",
        "fix_type": "REPLACE",
        "fix_code": "# Replace Haar Cascade with YOLOv8-Face\n# Install: pip install ultralytics\nfrom ultralytics import YOLO\n\nclass VisualCNN:\n    def __init__(self):\n        # Replace Haar Cascade\n        # self.face_cascade = cv2.CascadeClassifier(...)\n        # With YOLOv8-Face\n        self.face_detector = YOLO('yolov8n-face.pt')\n    \n    def detect_faces(self, image):\n        results = self.face_detector(image)\n        faces = []\n        for r in results:\n            boxes = r.boxes\n            for box in boxes:\n                x1, y1, x2, y2 = box.xyxy[0]\n                faces.append((int(x1), int(y1), int(x2-x1), int(y2-y1)))\n        return faces",
        "estimated_time": "2 hours + testing",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#6"
      },
      {
        "phase": 2,
        "priority": 63,
        "id": "P2-035",
        "file": "/home/user/geminivideo/services/video-agent/pro/smart_crop.py",
        "line": 165,
        "issue": "CRITICAL: Using Haar Cascade - replace with modern detection",
        "fix_type": "REPLACE",
        "fix_code": "# Same as P2-034 - replace Haar Cascade with YOLOv8-Face\nfrom ultralytics import YOLO\n\nclass SmartCrop:\n    def __init__(self):\n        self.face_detector = YOLO('yolov8n-face.pt')\n    \n    def detect_faces(self, frame):\n        results = self.face_detector(frame)\n        faces = []\n        for r in results:\n            boxes = r.boxes\n            for box in boxes:\n                x1, y1, x2, y2 = box.xyxy[0]\n                faces.append((int(x1), int(y1), int(x2-x1), int(y2-y1)))\n        return faces",
        "estimated_time": "2 hours + testing",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#6"
      }
    ]
  },
  "phase_3_medium_wrong_results": {
    "description": "These errors cause incorrect calculations and wrong recommendations. Fix after Phase 2.",
    "estimated_time": "4-5 days",
    "total_fixes": 15,
    "fixes": [
      {
        "phase": 3,
        "priority": 64,
        "id": "P3-001",
        "file": "/home/user/geminivideo/services/ml-service/src/thompson_sampler.py",
        "line": 206,
        "issue": "CRITICAL: Thompson Sampling algorithm wrong - increments alpha by reward value instead of 1",
        "fix_type": "EDIT",
        "fix_code": "# Replace lines 206-209\nif reward > 0:\n    variant['alpha'] += 1  # Binary outcome: success = +1\nelse:\n    variant['beta'] += 1   # Binary outcome: failure = +1",
        "estimated_time": "5 minutes + testing",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#1"
      },
      {
        "phase": 3,
        "priority": 65,
        "id": "P3-002",
        "file": "/home/user/geminivideo/services/ml-service/creative_attribution.py",
        "line": 549,
        "issue": "CRITICAL: Array index mismatch - using original indices on filtered arrays",
        "fix_type": "EDIT",
        "fix_code": "# Replace lines 535-549\nvalid_indices = []\nfor i in range(len(campaign_data)):\n    if feature_name in campaign_data[i]:\n        feature_values.append(campaign_data[i][feature_name])\n        valid_roas.append(roas_values[i])\n        valid_indices.append(i)\n\n# Apply mask\nfeature_clean = np.array(feature_values)[mask]\nroas_clean = np.array(valid_roas)[mask]\n\n# Use valid_indices to extract CTR values\nctr_values = [campaign_data[i].get('ctr', 0.0) for i in valid_indices]\nctr_clean = np.array(ctr_values)[mask]",
        "estimated_time": "15 minutes + testing",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#4"
      },
      {
        "phase": 3,
        "priority": 66,
        "id": "P3-003",
        "file": "/home/user/geminivideo/services/ml-service/src/auto_promoter.py",
        "line": 379,
        "issue": "Incorrect confidence interval calculation for two-tailed test",
        "fix_type": "EDIT",
        "fix_code": "# Add clarifying comment and improve calculation\n# For two-tailed test, p-value represents probability that means are different\nconfidence = 1 - p_value if p_value <= 1.0 else 0.0\n# Note: This is correct for two-tailed if interpreting confidence as\n# \"probability that means are different\"\n# For one-tailed, would use: confidence = 1 - (p_value / 2)",
        "estimated_time": "10 minutes",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#3"
      },
      {
        "phase": 3,
        "priority": 67,
        "id": "P3-004",
        "file": "/home/user/geminivideo/services/ml-service/campaign_tracker.py",
        "line": 835,
        "issue": "Percentile calculation using list.index() - wrong for duplicates",
        "fix_type": "EDIT",
        "fix_code": "# Replace lines 835-836 with proper percentile calculation\nimport numpy as np\n\n# Sort arrays first\nall_ctrs.sort()\nall_roases.sort()\n\n# Use searchsorted for correct percentile\nctr_percentile = (np.searchsorted(all_ctrs, creative_ctr) / len(all_ctrs)) * 100\nroas_percentile = (np.searchsorted(all_roases, creative_roas) / len(all_roases)) * 100",
        "estimated_time": "10 minutes + testing",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#6"
      },
      {
        "phase": 3,
        "priority": 68,
        "id": "P3-005",
        "file": "/home/user/geminivideo/services/ml-service/src/auto_scaler.py",
        "line": 763,
        "issue": "Misleading hourly calculation - assumes even distribution",
        "fix_type": "EDIT",
        "fix_code": "# Replace lines 763-764 with proper labeling\n# IMPORTANT: This is average hourly, not actual hourly data\navg_spend_hourly=metrics.spend / 24,  # Average hourly spend (not actual)\navg_revenue_hourly=metrics.revenue / 24,  # Average hourly revenue (not actual)\n\n# TODO: Fetch actual hourly metrics from API for accurate time-based optimization",
        "estimated_time": "5 minutes",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#7"
      },
      {
        "phase": 3,
        "priority": 69,
        "id": "P3-006",
        "file": "/home/user/geminivideo/services/ml-service/src/auto_promoter.py",
        "line": 943,
        "issue": "Incorrect compound improvement calculation - assumes multiplicative when tests are independent",
        "fix_type": "EDIT",
        "fix_code": "# Replace compound improvement calculation\n# For independent tests, use average improvement instead of compound\navg_improvement = np.mean(improvements)\ntotal_improvement = sum(improvements)  # If improvements are relative to baseline\n\n# Return average, not compound\nreturn {\n    'average_improvement': avg_improvement,\n    'total_improvement': total_improvement,\n    'num_tests': len(improvements)\n}",
        "estimated_time": "10 minutes + testing",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#9"
      },
      {
        "phase": 3,
        "priority": 70,
        "id": "P3-007",
        "file": "/home/user/geminivideo/services/titan-core/routing/ab_testing.py",
        "line": 310,
        "issue": "Cost comparison threshold too aggressive - 50% reduction rarely achieved",
        "fix_type": "EDIT",
        "fix_code": "# Replace with more realistic thresholds\nif cost < control_cost * 0.7 and confidence > control_confidence * 0.9:\n    # Cost winner (30% cost savings with 90% confidence retention)",
        "estimated_time": "5 minutes + testing",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#11"
      },
      {
        "phase": 3,
        "priority": 71,
        "id": "P3-008",
        "file": "/home/user/geminivideo/services/ml-service/roas_predictor.py",
        "line": 562,
        "issue": "Incorrect confidence calculation in model agreement",
        "fix_type": "EDIT",
        "fix_code": "# Replace confidence calculation\nmax_pred = max(abs(xgb_pred), abs(lgb_pred), 1.0)\nagreement = 1 - min(abs(xgb_pred - lgb_pred) / max_pred, 1.0)",
        "estimated_time": "5 minutes + testing",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#13"
      },
      {
        "phase": 3,
        "priority": 72,
        "id": "P3-009",
        "file": "/home/user/geminivideo/services/ml-service/campaign_tracker.py",
        "line": 1020,
        "issue": "CTR decline calculation has correct formula but add bounds check",
        "fix_type": "EDIT",
        "fix_code": "# Add bounds check to ensure only declines count as fatigue\nif previous_ctr > 0:\n    ctr_decline = ((previous_ctr - recent_ctr) / previous_ctr * 100)\n    ctr_decline = max(ctr_decline, 0)  # Only positive declines count as fatigue\nelse:\n    ctr_decline = 0.0",
        "estimated_time": "5 minutes",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#14"
      },
      {
        "phase": 3,
        "priority": 73,
        "id": "P3-010",
        "file": "/home/user/geminivideo/services/ml-service/src/ctr_model.py",
        "line": 463,
        "issue": "CRITICAL: Unrealistic CTR range in training data - clips to 10% when real max is 3%",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 463 with realistic Facebook/Meta CTR range\nctr = np.clip(ctr / 1.5, 0.005, 0.03)  # 0.5% to 3% range (realistic)",
        "estimated_time": "5 minutes + retrain models",
        "dependencies": [],
        "source_report": "LOGIC_ERRORS_REPORT.json#15"
      },
      {
        "phase": 3,
        "priority": 74,
        "id": "P3-011",
        "file": "/home/user/geminivideo/services/ml-service/requirements.txt",
        "line": 12,
        "issue": "pandas 2.1.3 is outdated",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 12\npandas>=2.2.0",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#1"
      },
      {
        "phase": 3,
        "priority": 75,
        "id": "P3-012",
        "file": "/home/user/geminivideo/services/titan-core/requirements.txt",
        "line": 40,
        "issue": "openai-whisper from November 2023",
        "fix_type": "EDIT",
        "fix_code": "# Replace line 40\nopenai-whisper>=20240930",
        "estimated_time": "3 minutes",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#1"
      },
      {
        "phase": 3,
        "priority": 76,
        "id": "P3-013",
        "file": "/home/user/geminivideo/frontend/package.json",
        "line": 29,
        "issue": "React 18.2.0 is from 2023",
        "fix_type": "EDIT",
        "fix_code": "// Update package.json line 29\n\"react\": \"^18.3.0\"",
        "estimated_time": "5 minutes + testing",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#2"
      },
      {
        "phase": 3,
        "priority": 77,
        "id": "P3-014",
        "file": "/home/user/geminivideo/frontend/package.json",
        "line": 24,
        "issue": "Firebase 10.7.0 is outdated",
        "fix_type": "EDIT",
        "fix_code": "// Update package.json line 24\n\"firebase\": \"^11.0.0\"",
        "estimated_time": "5 minutes + testing",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#2"
      },
      {
        "phase": 3,
        "priority": 78,
        "id": "P3-015",
        "file": "/home/user/geminivideo/services/ml-service/src/ctr_model.py",
        "line": 437,
        "issue": "Deprecated function generate_synthetic_training_data() still in codebase",
        "fix_type": "ADD",
        "fix_code": "# Add deprecation decorator\nimport warnings\n\ndef deprecated(func):\n    def wrapper(*args, **kwargs):\n        warnings.warn(f\"{func.__name__} is deprecated\", DeprecationWarning, stacklevel=2)\n        return func(*args, **kwargs)\n    return wrapper\n\n@deprecated\ndef generate_synthetic_training_data():\n    # ... existing code",
        "estimated_time": "5 minutes",
        "dependencies": [],
        "source_report": "CODE_QUALITY_ERROR_REPORT.json#ERROR-011"
      }
    ]
  },
  "phase_4_low_polish": {
    "description": "Performance, architecture, and code quality improvements. Fix after Phase 3.",
    "estimated_time": "6-8 days",
    "total_fixes": 11,
    "fixes": [
      {
        "phase": 4,
        "priority": 79,
        "id": "P4-001",
        "file": "/home/user/geminivideo/services/gateway-api/src/index.ts",
        "line": 174,
        "issue": "No retry logic on service-to-service calls - 37 axios calls without retry",
        "fix_type": "EDIT",
        "fix_code": "// Import retryWithBackoff that already exists\nimport { retryWithBackoff } from './middleware/error-handler';\n\n// Wrap all axios calls\nconst response = await retryWithBackoff(\n  () => axios.get(url, config),\n  3,     // max retries\n  1000,  // initial delay\n  10000  // max delay\n);",
        "estimated_time": "3 hours (37 calls to update)",
        "dependencies": [],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#SPOF-004"
      },
      {
        "phase": 4,
        "priority": 80,
        "id": "P4-002",
        "file": "/home/user/geminivideo/services/gateway-api/src/middleware/error-handler.ts",
        "line": 173,
        "issue": "CircuitBreaker implemented but never used",
        "fix_type": "ADD",
        "fix_code": "// Create circuit breaker instances for each service\nimport { CircuitBreaker } from './middleware/error-handler';\n\nconst mlServiceBreaker = new CircuitBreaker({ name: 'ml-service', timeout: 30000 });\nconst videoAgentBreaker = new CircuitBreaker({ name: 'video-agent', timeout: 60000 });\nconst titanCoreBreaker = new CircuitBreaker({ name: 'titan-core', timeout: 45000 });\n\n// Wrap service calls\nconst result = await mlServiceBreaker.call(() => axios.get(`${ML_SERVICE_URL}/predict`));",
        "estimated_time": "4 hours (create breakers + wrap calls)",
        "dependencies": ["P4-001"],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#OBS-003"
      },
      {
        "phase": 4,
        "priority": 81,
        "id": "P4-003",
        "file": "/home/user/geminivideo/services/gateway-api/src/multi-platform/status_aggregator.ts",
        "line": 66,
        "issue": "CRITICAL: In-memory state prevents horizontal scaling",
        "fix_type": "REPLACE",
        "fix_code": "// Replace in-memory Map with Redis storage\nimport { redisClient } from '../services/redis';\n\nclass StatusAggregator {\n  async updatePlatformStatus(jobId: string, platform: string, status: any) {\n    // Store in Redis instead of memory\n    await redisClient.hSet(`job:${jobId}:platforms`, platform, JSON.stringify(status));\n    \n    // Get all platforms for this job\n    const platforms = await redisClient.hGetAll(`job:${jobId}:platforms`);\n    \n    // Calculate overall status\n    const overallStatus = this.calculateOverallStatus(platforms);\n    await redisClient.hSet(`job:${jobId}`, 'status', overallStatus);\n  }\n  \n  async getJobStatus(jobId: string) {\n    return await redisClient.hGetAll(`job:${jobId}`);\n  }\n}",
        "estimated_time": "6 hours (refactor + testing)",
        "dependencies": [],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#SCALE-001"
      },
      {
        "phase": 4,
        "priority": 82,
        "id": "P4-004",
        "file": "/home/user/geminivideo/services/gateway-api/src/index.ts",
        "line": 502,
        "issue": "No idempotency keys for publishing operations",
        "fix_type": "ADD",
        "fix_code": "// Add idempotency middleware\nconst checkIdempotency = async (req, res, next) => {\n  const idempotencyKey = req.headers['idempotency-key'];\n  if (!idempotencyKey) {\n    return res.status(400).json({ error: 'Idempotency-Key header required' });\n  }\n  \n  // Check if request already processed\n  const cached = await redisClient.get(`idempotency:${idempotencyKey}`);\n  if (cached) {\n    return res.json(JSON.parse(cached));\n  }\n  \n  // Store original res.json\n  const originalJson = res.json.bind(res);\n  res.json = (data) => {\n    // Cache response for 24 hours\n    redisClient.setEx(`idempotency:${idempotencyKey}`, 86400, JSON.stringify(data));\n    return originalJson(data);\n  };\n  \n  next();\n};\n\n// Apply to publishing endpoints\napp.post('/api/publish/meta', checkIdempotency, async (req, res) => { ... });",
        "estimated_time": "3 hours",
        "dependencies": [],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#DATA-002"
      },
      {
        "phase": 4,
        "priority": 83,
        "id": "P4-005",
        "file": "/home/user/geminivideo/services/gateway-api/src/index.ts",
        "line": 1147,
        "issue": "No database transactions for multi-table operations",
        "fix_type": "EDIT",
        "fix_code": "// Use db.transaction() that already exists\nimport { db } from './services/database';\n\n// Wrap ad approval in transaction\nawait db.transaction(async (tx) => {\n  // Update ad status\n  await tx.query(\n    'UPDATE ads SET status = $1, approved_at = NOW() WHERE id = $2',\n    ['approved', adId]\n  );\n  \n  // Insert audit log\n  await tx.query(\n    'INSERT INTO audit_log (entity_type, entity_id, action, user_id) VALUES ($1, $2, $3, $4)',\n    ['ad', adId, 'approved', userId]\n  );\n});",
        "estimated_time": "2 hours (wrap all multi-table ops)",
        "dependencies": [],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#DATA-001"
      },
      {
        "phase": 4,
        "priority": 84,
        "id": "P4-006",
        "file": "/home/user/geminivideo/services/meta-publisher/src/index.ts",
        "line": 822,
        "issue": "Sequential DCO variant uploads - should parallelize",
        "fix_type": "EDIT",
        "fix_code": "// Replace sequential loop with parallel uploads\n// OLD: for (const variant of variants) { await uploadVariant(variant); }\n\n// NEW: Parallel uploads with concurrency limit\nconst pLimit = require('p-limit');\nconst limit = pLimit(5);  // Max 5 concurrent uploads\n\nconst uploadPromises = variants.map(variant => \n  limit(() => metaAdsManager.uploadVideo(variant))\n);\n\nconst results = await Promise.all(uploadPromises);",
        "estimated_time": "1 hour",
        "dependencies": [],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#SCALE-003"
      },
      {
        "phase": 4,
        "priority": 85,
        "id": "P4-007",
        "file": "/home/user/geminivideo/services/gateway-api/src/index.ts",
        "line": 2246,
        "issue": "Health checks don't verify dependencies",
        "fix_type": "EDIT",
        "fix_code": "// Replace static health check with dependency checks\napp.get('/health', async (req, res) => {\n  const checks = {\n    database: false,\n    redis: false,\n    status: 'unhealthy'\n  };\n  \n  try {\n    // Check database\n    await pgPool.query('SELECT 1');\n    checks.database = true;\n    \n    // Check Redis\n    await redisClient.ping();\n    checks.redis = true;\n    \n    // All checks passed\n    checks.status = 'healthy';\n    res.json(checks);\n  } catch (error) {\n    res.status(503).json({ ...checks, error: error.message });\n  }\n});",
        "estimated_time": "30 minutes",
        "dependencies": [],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#OBS-005"
      },
      {
        "phase": 4,
        "priority": 86,
        "id": "P4-008",
        "file": "/home/user/geminivideo/services/gateway-api/src/index.ts",
        "line": 37,
        "issue": "No compression middleware - wastes bandwidth",
        "fix_type": "ADD",
        "fix_code": "// Add compression middleware\nimport compression from 'compression';\n\napp.use(compression({\n  threshold: 1024,  // Only compress responses > 1KB\n  level: 6          // Compression level (0-9)\n}));",
        "estimated_time": "10 minutes",
        "dependencies": [],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#PERF-001"
      },
      {
        "phase": 4,
        "priority": 87,
        "id": "P4-009",
        "file": "/home/user/geminivideo/services/gateway-api/src/index.ts",
        "line": 106,
        "issue": "PostgreSQL Pool without max connections configured",
        "fix_type": "EDIT",
        "fix_code": "// Configure pool with limits\nconst pgPool = new Pool({\n  connectionString: DATABASE_URL,\n  max: 20,                    // Maximum connections\n  idleTimeoutMillis: 30000,   // Close idle connections after 30s\n  connectionTimeoutMillis: 2000,\n});",
        "estimated_time": "5 minutes",
        "dependencies": [],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#SCALE-005"
      },
      {
        "phase": 4,
        "priority": 88,
        "id": "P4-010",
        "file": "/home/user/geminivideo/services/gateway-api/src/services/logger.ts",
        "line": null,
        "issue": "598 console.log calls instead of structured logging",
        "fix_type": "REPLACE",
        "fix_code": "// Create structured logger\nimport winston from 'winston';\n\nexport const logger = winston.createLogger({\n  level: process.env.LOG_LEVEL || 'info',\n  format: winston.format.combine(\n    winston.format.timestamp(),\n    winston.format.errors({ stack: true }),\n    winston.format.json()\n  ),\n  defaultMeta: { service: 'gateway-api' },\n  transports: [\n    new winston.transports.Console(),\n    new winston.transports.File({ filename: 'error.log', level: 'error' }),\n    new winston.transports.File({ filename: 'combined.log' })\n  ]\n});\n\n// Replace all console.log with:\nlogger.info('message', { metadata });\nlogger.error('error message', { error, stack });",
        "estimated_time": "8 hours (598 replacements)",
        "dependencies": [],
        "source_report": "ARCHITECTURE_MISTAKES_REPORT.json#OBS-002"
      },
      {
        "phase": 4,
        "priority": 89,
        "id": "P4-011",
        "file": "/home/user/geminivideo/monitoring/metrics.py",
        "line": 429,
        "issue": "Update pricing for latest models in cost tracking",
        "fix_type": "EDIT",
        "fix_code": "# Update model pricing dictionary\nMODEL_PRICING = {\n    # OpenAI\n    'gpt-4o': {'input': 0.0025, 'output': 0.01},\n    'gpt-4o-2024-11-20': {'input': 0.0025, 'output': 0.01},\n    'gpt-4o-mini': {'input': 0.00015, 'output': 0.0006},\n    \n    # Anthropic\n    'claude-3-5-sonnet-20241022': {'input': 0.003, 'output': 0.015},\n    \n    # Google\n    'gemini-2.0-flash-thinking-exp': {'input': 0.0, 'output': 0.0},  # Free during preview\n    'gemini-2.0-flash-exp': {'input': 0.000075, 'output': 0.0003},\n    'gemini-1.5-flash': {'input': 0.000075, 'output': 0.0003},\n}",
        "estimated_time": "15 minutes",
        "dependencies": [],
        "source_report": "OUTDATED_TECH_REPORT.json#4,5"
      }
    ]
  },
  "testing_checklist": {
    "phase_1_tests": [
      "Run: docker-compose build --no-cache",
      "Verify all containers build successfully",
      "Run: docker-compose up -d",
      "Verify all containers start and stay healthy",
      "Check health endpoints: curl http://localhost:8080/health",
      "Verify Prisma migrations: docker exec gateway-api npx prisma migrate status",
      "Test frontend: curl http://localhost:3000",
      "Check all service logs for errors: docker-compose logs"
    ],
    "phase_2_tests": [
      "Test POST /api/campaigns/:id/resume",
      "Test GET /api/analytics/roi/performance",
      "Test GET /api/analytics/roi/trends",
      "Test POST /api/ab-tests/:id/start",
      "Test POST /api/ab-tests/:id/stop",
      "Test AB test promote with correct schema",
      "Test POST /api/publish/google",
      "Test POST /api/publish/tiktok",
      "Test GET /api/publish/campaigns/:id",
      "Verify all Gemini 2.0 model calls work",
      "Verify face detection accuracy improvement"
    ],
    "phase_3_tests": [
      "Test Thompson Sampling with binary rewards",
      "Verify CTR calculations don't divide by zero",
      "Test feature correlation analysis with filtered data",
      "Run A/B test winner determination with realistic data",
      "Verify percentile calculations with duplicate values",
      "Test model prediction with edge cases",
      "Retrain CTR model with realistic data range",
      "Verify all calculation outputs are correct"
    ],
    "phase_4_tests": [
      "Load test with retry logic enabled",
      "Test circuit breaker failure scenarios",
      "Verify horizontal scaling with Redis state",
      "Test idempotency with duplicate requests",
      "Test database transactions rollback on error",
      "Verify parallel DCO uploads performance",
      "Test health checks with dependency failures",
      "Measure bandwidth savings with compression",
      "Load test PostgreSQL connection pooling",
      "Verify structured logging output"
    ]
  },
  "rollout_strategy": {
    "phase_1": {
      "description": "Fix all startup blockers",
      "timeline": "Days 1-4",
      "deployment": "Deploy to development environment",
      "validation": "Verify entire stack starts successfully",
      "rollback_plan": "Git revert to previous commit"
    },
    "phase_2": {
      "description": "Fix demo blockers and API mismatches",
      "timeline": "Days 5-11",
      "deployment": "Deploy to staging environment",
      "validation": "Run full investor demo flow",
      "rollback_plan": "Database migrations have down scripts"
    },
    "phase_3": {
      "description": "Fix logic errors and calculations",
      "timeline": "Days 12-16",
      "deployment": "Deploy to staging, monitor for 2 days",
      "validation": "Compare old vs new calculation outputs",
      "rollback_plan": "Feature flag to switch between old/new logic"
    },
    "phase_4": {
      "description": "Performance and architecture improvements",
      "timeline": "Days 17-24",
      "deployment": "Gradual rollout to production (canary deployment)",
      "validation": "Monitor metrics, circuit breakers, performance",
      "rollback_plan": "Scale down new instances, scale up old instances"
    }
  },
  "success_criteria": {
    "phase_1_complete": {
      "all_containers_build": true,
      "all_containers_healthy": true,
      "no_compilation_errors": true,
      "database_migrations_applied": true,
      "frontend_loads": true
    },
    "phase_2_complete": {
      "all_api_endpoints_respond": true,
      "investor_demo_runs_end_to_end": true,
      "no_404_errors": true,
      "no_400_validation_errors": true,
      "modern_models_in_use": true
    },
    "phase_3_complete": {
      "thompson_sampling_converges_correctly": true,
      "no_division_by_zero_errors": true,
      "calculation_outputs_validated": true,
      "ab_test_winners_correct": true,
      "ml_predictions_accurate": true
    },
    "phase_4_complete": {
      "horizontal_scaling_works": true,
      "retry_logic_prevents_failures": true,
      "circuit_breakers_active": true,
      "idempotency_prevents_duplicates": true,
      "performance_improved": true
    }
  },
  "investor_demo_readiness": {
    "current_state": "NOT READY",
    "blockers": [
      "System won't start (Phase 1 errors)",
      "API endpoints return 404 (Phase 2 errors)",
      "Wrong calculations shown (Phase 3 errors)"
    ],
    "ready_after_phase": 2,
    "confidence_level_after_phase_2": "85% - Can demo core features",
    "confidence_level_after_phase_3": "95% - Results are accurate",
    "confidence_level_after_phase_4": "99% - Production ready"
  }
}

version: '3.8'

services:
  gateway-api:
    build:
      context: ./services/gateway-api
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    environment:
      - PORT=8080
      - VIDEO_AGENT_URL=http://video-agent:8001
      - DRIVE_INTEL_URL=http://drive-intel:8002
      - META_PUBLISHER_URL=http://meta-publisher:8003
      - WEIGHTS_PATH=/app/shared/config/weights.yaml
    volumes:
      - ./shared:/app/shared
      - ./data:/app/data
    depends_on:
      - video-agent
      - drive-intel
      - meta-publisher
    networks:
      - geminivideo-network

  video-agent:
    build:
      context: ./services/video-agent
      dockerfile: Dockerfile
    ports:
      - "8001:8001"
    environment:
      - PORT=8001
    volumes:
      - ./data:/app/data
    networks:
      - geminivideo-network

  drive-intel:
    build:
      context: ./services/drive-intel
      dockerfile: Dockerfile
    ports:
      - "8002:8002"
    environment:
      - PORT=8002
    volumes:
      - ./data:/app/data
    networks:
      - geminivideo-network

  meta-publisher:
    build:
      context: ./services/meta-publisher
      dockerfile: Dockerfile
    ports:
      - "8003:8003"
    environment:
      - PORT=8003
    networks:
      - geminivideo-network

networks:
  geminivideo-network:
    driver: bridge

# üö® API CONTRACT MISMATCH REPORT
**Generated by AGENT 66: API CONTRACT MISMATCH HUNTER**
**Date:** 2025-12-05

---

## üìä Executive Summary

**CRITICAL FINDING:** 75% of frontend hooks have breaking API mismatches.

- **Total Mismatches Found:** 11
- **Critical Breaking Issues:** 9
- **Schema Mismatches:** 2
- **Will Cause 404 Errors:** 8
- **Will Cause 400 Errors:** 1
- **Production Impact:** üî¥ **WILL BREAK** - Estimated 8-12 critical bug reports on launch

---

## üî• CRITICAL BREAKING MISMATCHES

### 1. Campaign Resume Endpoint Missing ‚ùå
**SEVERITY:** CRITICAL | **ERROR:** 404 Not Found

**Frontend:**
- File: `/home/user/geminivideo/frontend/src/lib/api.ts:418`
- Calls: `POST /api/campaigns/${campaignId}/resume`
- Hook: `useResumeCampaign()` in `useCampaigns.ts:170`

**Backend:**
- File: `/home/user/geminivideo/services/gateway-api/src/routes/campaigns.ts`
- Has: `POST /api/campaigns/:id/launch` (line 503)
- Has: `POST /api/campaigns/:id/pause` (line 603)
- **Missing:** `/resume` endpoint

**Impact:**
- Users **CANNOT** resume paused campaigns
- Resume button will fail silently with 404
- Workflow broken

**Fix:** Add `POST /api/campaigns/:id/resume` endpoint (set status='active')

---

### 2. Analytics ROI Endpoints Missing ‚ùå‚ùå
**SEVERITY:** CRITICAL | **ERROR:** 404 Not Found

**Frontend:**
- File: `/home/user/geminivideo/frontend/src/lib/api.ts:464,471`
- Calls:
  - `GET /api/analytics/roi/performance`
  - `GET /api/analytics/roi/trends`
- Hooks: `useROIPerformance()`, `useROITrends()` in `useAnalytics.ts`

**Backend:**
- File: `/home/user/geminivideo/services/gateway-api/src/routes/analytics.ts`
- Has: `/overview`, `/campaigns/:id`, `/trends`, `/predictions-vs-actual`, `/real-time`
- **Missing:** ALL `/api/analytics/roi/*` routes

**Impact:**
- ROI/ROAS dashboards will **NOT LOAD**
- Performance widgets show loading spinner forever
- Critical investor demo feature broken

**Fix:** Implement `/api/analytics/roi/performance` and `/api/analytics/roi/trends`

---

### 3. A/B Test Start/Stop Endpoints Missing ‚ùå‚ùå
**SEVERITY:** CRITICAL | **ERROR:** 404 Not Found

**Frontend:**
- File: `/home/user/geminivideo/frontend/src/lib/api.ts:518,524`
- Calls:
  - `POST /api/ab-tests/${testId}/start`
  - `POST /api/ab-tests/${testId}/stop`
- Hooks: `useStartABTest()`, `useStopABTest()` in `useABTests.ts`

**Backend:**
- File: `/home/user/geminivideo/services/gateway-api/src/routes/ab-tests.ts`
- Has: `POST /api/ab-tests/:id/pause` (line 485)
- **Missing:** `/start` and `/stop` endpoints

**Impact:**
- Cannot start A/B tests
- Cannot stop A/B tests (only pause)
- A/B testing workflow incomplete

**Fix:** Add `/start` and `/stop` endpoints OR map to existing lifecycle

---

### 4. A/B Test Promote Schema Mismatch ‚ùå
**SEVERITY:** CRITICAL | **ERROR:** 400 Bad Request

**Frontend:**
- File: `/home/user/geminivideo/frontend/src/lib/api.ts:531`
- Sends:
```typescript
{
  winner: 'A' | 'B'
}
```

**Backend:**
- File: `/home/user/geminivideo/services/gateway-api/src/routes/ab-tests.ts:440`
- Expects:
```typescript
{
  variant_id: uuid,  // REQUIRED
  new_budget: number // REQUIRED, min: 1
}
```

**Impact:**
- Promoting winning variants **FAILS** with validation error
- Cannot complete A/B tests
- Frontend sends wrong data shape

**Fix:** Frontend must send `{ variant_id, new_budget }` instead of `{ winner }`

---

### 5. Google & TikTok Publish Endpoints Missing ‚ùå‚ùå
**SEVERITY:** CRITICAL | **ERROR:** 404 Not Found

**Frontend:**
- File: `/home/user/geminivideo/frontend/src/lib/api.ts:556,563`
- Calls:
  - `POST /api/publish/google`
  - `POST /api/publish/tiktok`
- Hooks: `usePublishToGoogle()`, `usePublishToTikTok()` in `usePublishing.ts`

**Backend:**
- File: `/home/user/geminivideo/services/gateway-api/src/index.ts`
- Has: `POST /api/publish/meta` (line 502) ‚úÖ
- Has: `POST /api/publish/multi` (line 1893) - multi-platform
- Has: `POST /api/google-ads/publish` (line 853) - **DIFFERENT PATH!**
- **Missing:** `/api/publish/google`, `/api/publish/tiktok`

**Impact:**
- Cannot publish to Google Ads via expected endpoint
- Cannot publish to TikTok at all
- Multi-platform publishing broken

**Fix:** Add `/api/publish/google` and `/api/publish/tiktok` proxy endpoints

---

### 6. Campaign Publish Jobs Endpoint Missing ‚ùå
**SEVERITY:** CRITICAL | **ERROR:** 404 Not Found

**Frontend:**
- File: `/home/user/geminivideo/frontend/src/lib/api.ts:578`
- Calls: `GET /api/publish/campaigns/${campaignId}`
- Hook: `useCampaignPublishJobs()` in `usePublishing.ts:48`

**Backend:**
- File: `/home/user/geminivideo/services/gateway-api/src/index.ts`
- Has: `GET /api/publish/status/:job_id` (line 1972)
- Has: `GET /api/publish/jobs` (line 2107) - all jobs
- **Missing:** `/api/publish/campaigns/:campaignId`

**Impact:**
- Cannot view publishing history per campaign
- Cannot track campaign-specific publish jobs
- Publishing progress tracking broken

**Fix:** Implement `GET /api/publish/campaigns/:campaignId`

---

### 7. Prediction Accuracy Endpoint Path Wrong ‚ùå
**SEVERITY:** HIGH | **ERROR:** 404 Not Found

**Frontend:**
- File: `/home/user/geminivideo/frontend/src/lib/api.ts:458`
- Calls: `GET /api/analytics/predictions/accuracy`
- Hook: `usePredictionAccuracy()` in `useAnalytics.ts:94`

**Backend:**
- File: `/home/user/geminivideo/services/gateway-api/src/routes/predictions.ts:250`
- **Actual Path:** `GET /api/predictions/accuracy`
- Note: Predictions router mounted at `/api/predictions`, NOT `/api/analytics/predictions`

**Impact:**
- Prediction accuracy metrics won't load
- ML performance dashboard broken

**Fix:** Frontend call `/api/predictions/accuracy` OR backend add route at `/api/analytics/predictions/accuracy`

---

## üìã SCHEMA MISMATCHES

### Campaign Type Structure Mismatch
**SEVERITY:** HIGH | **ERROR:** Runtime data missing

**Frontend Expects:**
```typescript
interface Campaign {
  id?: string;
  name: string;
  objective: CampaignObjective;          // ‚ùå MISSING
  creatives: CampaignCreative[];         // ‚ùå MISSING
  targeting: TargetingConfig;            // ‚ùå WRONG (gets target_audience json)
  budget: BudgetConfig;                  // ‚ùå WRONG (gets budget_daily number)
  schedule: ScheduleConfig;              // ‚ùå MISSING
  status: 'draft' | 'pending' | 'active' | 'paused' | 'completed';
  predictions?: CampaignPredictions;     // ‚ùå MISSING
  abTestConfig?: ABTestConfig;           // ‚ùå MISSING
}
```

**Backend Returns:**
```typescript
{
  id: "uuid",
  name: "string",
  status: "string",
  budget_daily: number,              // ‚ö†Ô∏è Not a BudgetConfig object!
  target_audience: {},               // ‚ö†Ô∏è Not a TargetingConfig object!
  created_at: "timestamp",
  updated_at: "timestamp",
  stats: { ... }                     // ‚úÖ Extra field
}
```

**Missing Fields:**
- `objective` - Required for campaign creation
- `creatives` - Array of CampaignCreative
- `schedule` - ScheduleConfig with startDate, endDate
- `predictions` - ML predictions
- `abTestConfig` - A/B test configuration

**Impact:**
- UI shows "undefined" for missing fields
- Campaign forms may break
- Budget/targeting display broken

---

### snake_case vs camelCase
**SEVERITY:** MEDIUM | **ERROR:** Type mismatch

**Backend uses snake_case:**
- `budget_daily`, `target_audience`, `created_at`, `updated_at`

**Frontend TypeScript expects camelCase:**
- `budgetDaily`, `targetAudience`, `createdAt`, `updatedAt`

**Impact:**
- Manual data transformation required
- Type safety lost
- Inconsistent code

---

## üìù MISSING ENDPOINTS SUMMARY

### Campaign Endpoints
- ‚ùå `POST /api/campaigns/:id/resume` - MISSING

### Analytics Endpoints
- ‚ùå `GET /api/analytics/roi/performance` - MISSING
- ‚ùå `GET /api/analytics/roi/trends` - MISSING
- ‚ö†Ô∏è `GET /api/analytics/predictions/accuracy` - WRONG PATH

### A/B Test Endpoints
- ‚ùå `POST /api/ab-tests/:id/start` - MISSING
- ‚ùå `POST /api/ab-tests/:id/stop` - MISSING

### Publishing Endpoints
- ‚ùå `POST /api/publish/google` - MISSING
- ‚ùå `POST /api/publish/tiktok` - MISSING
- ‚ùå `GET /api/publish/campaigns/:campaignId` - MISSING

---

## üîß IMMEDIATE FIXES REQUIRED (Priority Order)

### Priority 1: Add Campaign Resume ‚ö†Ô∏è
**File:** `/home/user/geminivideo/services/gateway-api/src/routes/campaigns.ts`
**Action:** Add resume endpoint after line 656:
```typescript
router.post('/:id/resume', async (req, res) => {
  // Similar to pause but set status='active'
  await pgPool.query(
    "UPDATE campaigns SET status='active', updated_at=NOW() WHERE id=$1",
    [req.params.id]
  );
});
```

### Priority 2: Add Publishing Proxies ‚ö†Ô∏è‚ö†Ô∏è
**File:** `/home/user/geminivideo/services/gateway-api/src/index.ts`
**Action:** Add after line 651:
```typescript
// POST /api/publish/google
app.post('/api/publish/google', uploadRateLimiter, async (req, res) => {
  // Proxy to google-ads service or use multi-platform
});

// POST /api/publish/tiktok
app.post('/api/publish/tiktok', uploadRateLimiter, async (req, res) => {
  // Proxy to tiktok-ads service or use multi-platform
});
```

### Priority 3: Add Analytics ROI Routes ‚ö†Ô∏è‚ö†Ô∏è
**File:** `/home/user/geminivideo/services/gateway-api/src/routes/analytics.ts`
**Action:** Add after line 650:
```typescript
// GET /api/analytics/roi/performance
router.get('/roi/performance', async (req, res) => {
  // Query performance_metrics, calculate ROAS
});

// GET /api/analytics/roi/trends
router.get('/roi/trends', async (req, res) => {
  // Query time-series ROAS data
});
```

### Priority 4: Fix promoteWinner Schema ‚ö†Ô∏è
**Option A - Frontend Fix:**
```typescript
// frontend/src/lib/api.ts:531
async promoteWinner(testId: string, winner: 'A' | 'B'): Promise<ABTest> {
  // Get variant_id from test first
  const test = await this.getABTestById(testId);
  const variantId = winner === 'A' ? test.variantA.id : test.variantB.id;

  return this.post(`/api/ab-tests/${testId}/promote`, {
    variant_id: variantId,
    new_budget: test.totalBudget // or calculate
  });
}
```

**Option B - Backend Fix:**
```typescript
// Map { winner: 'A'|'B' } to variant_id internally
```

### Priority 5: Add A/B Test Lifecycle ‚ö†Ô∏è‚ö†Ô∏è
**File:** `/home/user/geminivideo/services/gateway-api/src/routes/ab-tests.ts`
**Action:** Add after line 541:
```typescript
// POST /api/ab-tests/:id/start
router.post('/:id/start', async (req, res) => {
  await pgPool.query("UPDATE campaigns SET status='active' WHERE id=$1", [req.params.id]);
});

// POST /api/ab-tests/:id/stop
router.post('/:id/stop', async (req, res) => {
  await pgPool.query("UPDATE campaigns SET status='completed' WHERE id=$1", [req.params.id]);
});
```

---

## üß™ TESTING CHECKLIST

Run these tests - **THEY WILL FAIL:**

```bash
# Campaign endpoints
curl -X POST http://localhost:8000/api/campaigns/123/resume
# Expected: 404 Not Found ‚ùå

# Analytics ROI endpoints
curl http://localhost:8000/api/analytics/roi/performance?timeRange=30d
# Expected: 404 Not Found ‚ùå

curl http://localhost:8000/api/analytics/roi/trends?period=weekly
# Expected: 404 Not Found ‚ùå

# A/B test endpoints
curl -X POST http://localhost:8000/api/ab-tests/123/start
# Expected: 404 Not Found ‚ùå

curl -X POST http://localhost:8000/api/ab-tests/123/stop
# Expected: 404 Not Found ‚ùå

curl -X POST http://localhost:8000/api/ab-tests/123/promote \
  -H "Content-Type: application/json" \
  -d '{"winner":"A"}'
# Expected: 400 Bad Request - Missing variant_id, new_budget ‚ùå

# Publishing endpoints
curl -X POST http://localhost:8000/api/publish/google \
  -H "Content-Type: application/json" \
  -d '{"campaignId":"123","adAccountId":"456"}'
# Expected: 404 Not Found ‚ùå

curl -X POST http://localhost:8000/api/publish/tiktok \
  -H "Content-Type: application/json" \
  -d '{"campaignId":"123","adAccountId":"456"}'
# Expected: 404 Not Found ‚ùå

curl http://localhost:8000/api/publish/campaigns/123
# Expected: 404 Not Found ‚ùå

# Prediction accuracy (wrong path)
curl http://localhost:8000/api/analytics/predictions/accuracy
# Expected: 404 Not Found ‚ùå
# Correct path: /api/predictions/accuracy
```

---

## üìà IMPACT ASSESSMENT

| Metric | Value |
|--------|-------|
| **Total Frontend Hooks** | 4 |
| **Hooks with Breaking Issues** | 3 (75%) |
| **Affected Hooks** | useCampaigns, useAnalytics, useABTests, usePublishing |
| **Will Break in Production?** | üî¥ **YES** |
| **Estimated Bug Reports** | 8-12 critical issues |
| **Developer Hours to Fix** | 16-24 hours |

### Affected Features
- ‚ùå Campaign resume workflow
- ‚ùå ROI/ROAS dashboards
- ‚ùå A/B test lifecycle management
- ‚ùå Multi-platform publishing
- ‚ùå Prediction accuracy metrics
- ‚ö†Ô∏è Campaign data completeness
- ‚ö†Ô∏è Type safety

---

## üéØ RECOMMENDATIONS

### Immediate Actions (Before Launch)
1. ‚úÖ Add all missing endpoints (9 endpoints)
2. ‚úÖ Fix schema mismatches (2 issues)
3. ‚úÖ Align TypeScript types with backend responses
4. ‚úÖ Add integration tests for ALL hooks
5. ‚úÖ Run E2E tests on actual API

### Long-term Improvements
1. **API Contract Testing:** Add contract tests using Pact or similar
2. **OpenAPI Schema:** Generate TypeScript types from OpenAPI spec
3. **Naming Convention:** Standardize on camelCase or snake_case (pick one!)
4. **Response Transformation:** Add middleware to transform backend responses to match frontend types
5. **Documentation:** Keep API docs in sync with implementation

---

## üìÇ Files to Review

### Frontend
- `/home/user/geminivideo/frontend/src/lib/api.ts` - Main API client
- `/home/user/geminivideo/frontend/src/hooks/useCampaigns.ts` - Campaign hooks
- `/home/user/geminivideo/frontend/src/hooks/useAnalytics.ts` - Analytics hooks
- `/home/user/geminivideo/frontend/src/hooks/useABTests.ts` - A/B test hooks
- `/home/user/geminivideo/frontend/src/hooks/usePublishing.ts` - Publishing hooks

### Backend
- `/home/user/geminivideo/services/gateway-api/src/index.ts` - Main gateway
- `/home/user/geminivideo/services/gateway-api/src/routes/campaigns.ts` - Campaign routes
- `/home/user/geminivideo/services/gateway-api/src/routes/analytics.ts` - Analytics routes
- `/home/user/geminivideo/services/gateway-api/src/routes/ab-tests.ts` - A/B test routes
- `/home/user/geminivideo/services/gateway-api/src/routes/predictions.ts` - Prediction routes

---

**üö® CRITICAL: These mismatches WILL cause production failures. Fix before launch! üö®**
